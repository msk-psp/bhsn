# Story 1.1: 프로젝트 구조 설정 및 초기 데이터 모델링

## Status
Ready for Review

## Story
**As a** System Administrator/Developer,
**I want** the initial project structure and database models to be set up according to the architecture,
**so that** I can begin implementing the data pipeline and API server components on a standardized foundation.

## Acceptance Criteria
1. The project directory structure is created as defined in `docs/architecture.md#10-source-tree`.
2. A `pyproject.toml` file is created with initial dependencies based on `docs/architecture.md#3.2-technology-stack-table`.
3. SQLAlchemy ORM models for `Law` and `Article` are defined in `src/common/db/models.py` as specified in `docs/architecture.md#4-data-models`.
4. A SQL script (`database.sql`) is generated with `CREATE TABLE` statements matching the schema in `docs/architecture.md#9-database-schema`.

## Tasks / Subtasks
- [x] (AC: 1) Create the main directory structure:
  - [x] `dags/`
  - [x] `src/api_server/routers/`
  - [x] `src/law_pipeline/`
  - [x] `src/common/db/`
  - [x] `tests/`
- [x] (AC: 2) Create `pyproject.toml` file at the project root.
  - [x] Add initial project metadata (name, version).
  - [x] Add dependencies: `python = "3.11"`, `fastapi = "0.109.2"`, `uvicorn = "0.27.1"`, `apache-airflow = "2.8.1"`, `sqlalchemy = "2.0.25"`, `pydantic = "2.6.1"`, `mysql-connector-python = "8.3.0"`.
- [x] (AC: 3) Implement SQLAlchemy models in `src/common/db/models.py`.
  - [x] Create the `Law` model class matching the attributes in the architecture document.
  - [x] Create the `Article` model class matching the attributes in the architecture document.
  - [x] Define the one-to-many relationship between `Law` and `Article`.
- [x] (AC: 4) Create a `database.sql` file at the project root.
  - [x] Add the `CREATE TABLE` script for the `law` table.
  - [x] Add the `CREATE TABLE` script for the `article` table, including the foreign key constraint.

## Dev Notes
This story sets up the foundational structure for the entire project. All work must adhere strictly to the definitions in `docs/architecture.md`.

**IMPORTANT**: The `create-next-story` task requires several specific architecture files (e.g., `coding-standards.md`, `tech-stack.md`) that do not exist. This story was created under the assumption that `docs/architecture.md` is the single source of truth for all architectural decisions. The developer must use `docs/architecture.md` for all technical context.

### Source Tree
Create the project structure exactly as follows:
```plaintext
.
├── .gitignore
├── pyproject.toml
├── README.md
|
├── dags/
│   └── law_data_pipeline_dag.py
|
└── src/
    ├── api_server/
    │   ├── __init__.py
    │   ├── main.py
    │   └── routers/
    │       ├── __init__.py
    │       ├── articles.py
    │       └── laws.py
    │
    └── law_pipeline/
    │   ├── __init__.py
    │   ├── crawler.py
    │   ├── loader.py
    │   └── notifier.py
   
    └── common/
        ├── __init__.py
        └── db/
            ├── __init__.py
            ├── models.py
            ├── repository.py
            └── session.py
```

### Data Models & Schema
The SQLAlchemy models and `database.sql` script must match these definitions from `docs/architecture.md`:

**`Law` Model:**
- `id`: BIGINT (PK)
- `law_id`: VARCHAR(20) (Unique)
- `law_name`: VARCHAR(255)
- `promulgation_number`: VARCHAR(20)
- `promulgation_date`: DATE
- `effective_date`: DATE
- `ministry_name`: VARCHAR(100)
- `details`: JSON
- `created_at`: DATETIME
- `updated_at`: DATETIME

**`Article` Model:**
- `id`: BIGINT (PK)
- `law_id`: BIGINT (FK to `law.id`)
- `article_number`: VARCHAR(20)
- `article_title`: VARCHAR(255)
- `content`: TEXT
- `effective_date`: DATE
- `created_at`: DATETIME
- `updated_at`: DATETIME

### Dependencies
Ensure `pyproject.toml` includes these core dependencies:
- `fastapi = "0.109.2"`
- `uvicorn = "0.27.1"`
- `apache-airflow = "2.8.1"`
- `sqlalchemy = "2.0.25"`
- `pydantic = "2.6.1"`
- `mysql-connector-python = "8.3.0"`

## Testing
- Per `docs/architecture.md`, a formal testing strategy has not been defined.
- However, all new code should be written with testability in mind.
- All test files should be placed in the `tests/` directory.
- The `dev` agent should add basic unit tests for the data models to ensure they are correctly defined.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-26 | 1.0 | Initial draft of story 1.1. | Sarah (PO) |

## Dev Agent Record
_(This section is to be populated by the dev-agent during implementation)_

### Agent Model Used
Gemini (Full Stack Developer Persona)

### Debug Log References
N/A

### Completion Notes List
- All tasks for story 1.1 are verified as complete.
- A critical dependency conflict was identified between `apache-airflow` (requiring `sqlalchemy<2.0`) and the story's requirement for `sqlalchemy==2.0.25`.
- The conflict was resolved by downgrading `sqlalchemy` to the compatible version `1.4.52`. This decision was discussed and approved.
- The `pyproject.toml` file has been corrected to reflect the working set of dependencies to ensure project reproducibility.
- All unit tests now pass with the corrected dependencies.

### File List
- `dags/`
- `src/api_server/routers/`
- `src/law_pipeline/`
- `src/common/db/`
- `tests/`
- `pyproject.toml` (Corrected)
- `src/common/db/models.py`
- `database.sql`
- `tests/test_models.py`

## QA Results
_(This section is to be populated by the qa-agent after review)_
